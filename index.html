<!-- 
    OCH CyberLingua | The C-Suite Translator
    Built by Martin M. Kamethu for Ongoza Cyber Hub
    Version 2.12 (Elaborative Guide Update)
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OCH CyberLingua | Built by Martin M. Kamethu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            color: #e2e8f0; /* Slate 200 */
        }
        
        .font-mono { font-family: 'JetBrains Mono', monospace; }

        .gradient-text {
            background: linear-gradient(to right, #22d3ee, #34d399);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .gold-text {
            background: linear-gradient(to right, #fbbf24, #d97706);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: rgba(34, 211, 238, 0.3);
            box-shadow: 0 0 20px rgba(34, 211, 238, 0.1);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; opacity: 0; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="h-screen w-screen overflow-hidden flex flex-col bg-slate-950">

    <!-- Header -->
    <header class="border-b border-slate-800 bg-slate-900/90 shrink-0 z-50 h-16 flex items-center">
        <div class="w-full px-4 flex justify-between items-center">
            
            <!-- Brand & Author Section -->
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-2">
                    <i data-lucide="shield-check" class="text-cyan-400 h-7 w-7"></i>
                    <div>
                        <h1 class="text-lg font-bold text-white tracking-tight leading-none">OCH <span class="gradient-text">CyberLingua</span></h1>
                        <p class="text-[10px] text-slate-500 font-mono uppercase tracking-widest">Powered by Ongoza Cyber Hub</p>
                    </div>
                </div>
                
                <div class="h-8 w-px bg-slate-800 hidden md:block"></div>

                <div class="hidden md:flex flex-col justify-center">
                    <h2 class="text-xs font-semibold text-slate-300">Martin M. Kamethu</h2>
                    <div class="flex items-center gap-1.5">
                        <i data-lucide="compass" class="h-3 w-3 text-amber-400"></i>
                        <span class="text-[10px] font-medium tracking-wide text-slate-400">
                            Curious about the Intersection of <span class="text-cyan-400 font-bold">Cyber</span>, <span class="text-emerald-400 font-bold">AI</span> & <span class="text-rose-400 font-bold">Risk</span>
                        </span>
                    </div>
                </div>
            </div>

            <!-- Right Side: Controls & Connect -->
            <div class="flex items-center gap-3">
                <div class="md:hidden flex flex-col text-right mr-2">
                    <span class="text-[10px] font-semibold text-slate-200">Martin M. Kamethu</span>
                </div>

                <div class="flex items-center gap-4">
                    <div class="flex items-center gap-1 bg-slate-800/80 px-2 py-1 rounded-full border border-slate-700/50 shadow-sm">
                        <a href="https://www.linkedin.com/in/martin-m-kamethu-b703a666/" target="_blank" class="p-1.5 text-slate-400 hover:text-white hover:bg-slate-700 rounded-full transition-all" title="LinkedIn">
                            <i data-lucide="linkedin" class="h-3.5 w-3.5"></i>
                        </a>
                        <a href="https://www.ongozacyberhub.org/" target="_blank" class="p-1.5 text-slate-400 hover:text-white hover:bg-slate-700 rounded-full transition-all" title="Ongoza Cyber Hub">
                            <i data-lucide="globe" class="h-3.5 w-3.5"></i>
                        </a>
                    </div>

                    <div class="hidden lg:flex items-center gap-2 text-[10px] font-mono text-slate-500 bg-slate-950 px-3 py-1 rounded-md border border-slate-800" id="systemStatus">
                        <span class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></span>
                        LOCAL MODE
                    </div>
                    
                    <button onclick="toggleSettings()" class="p-2 hover:bg-slate-800 rounded-lg transition-colors text-slate-400 hover:text-cyan-400">
                        <i data-lucide="settings" class="h-5 w-5"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- HERO EXPLAINER (One-Liner Version) -->
    <section class="bg-slate-950 border-b border-slate-800 py-3 shrink-0">
        <div class="max-w-4xl mx-auto text-center px-4">
            <p class="text-xs md:text-sm text-slate-400 font-medium">
                Bridge the gap between the <span class="text-cyan-400 font-bold">Server Room</span> & the <span class="text-emerald-400 font-bold">Boardroom</span> by translating technical noise into strategic narratives.
            </p>
        </div>
    </section>

    <!-- Main Content -->
    <main class="flex-1 flex overflow-hidden p-4 gap-4">
        
        <!-- SIDEBAR -->
        <aside class="w-80 shrink-0 bg-slate-900 border-r border-slate-800 rounded-xl flex flex-col overflow-y-auto p-4 gap-4">
            
            <!-- Configuration Card -->
            <div class="card p-5 rounded-xl border-t-2 border-t-cyan-500/50">
                <h2 class="text-sm font-bold text-white mb-4 flex items-center gap-2 uppercase tracking-wider">
                    <i data-lucide="sliders" class="h-4 w-4 text-cyan-400"></i> Configure Narrative
                </h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-[10px] uppercase font-bold text-slate-500 mb-1">1. What is the Threat?</label>
                        <div class="relative group">
                            <input list="topics" id="topicInput" placeholder="Select or Type..." class="w-full bg-slate-950 border border-slate-700 rounded-lg p-2 text-xs text-white focus:border-cyan-500 outline-none placeholder-slate-600 transition-colors">
                            <datalist id="topics">
                                <option value="Agentic AI"><option value="Non-Human Identity"><option value="Ransomware"><option value="Third-Party Risk"><option value="Zero Trust">
                            </datalist>
                            <i data-lucide="search" class="absolute right-2 top-2.5 h-3.5 w-3.5 text-slate-600 group-hover:text-cyan-500"></i>
                        </div>
                    </div>

                    <div>
                        <label class="block text-[10px] uppercase font-bold text-slate-500 mb-1">2. Who is in the Room?</label>
                        <select id="audienceInput" class="w-full bg-slate-950 border border-slate-700 rounded-lg p-2 text-xs text-white focus:border-cyan-500 outline-none cursor-pointer">
                            <option value="Board">Board (Strategy)</option>
                            <option value="CFO">CFO (Money)</option>
                            <option value="Employees">Employees (Culture)</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-[10px] uppercase font-bold text-slate-500 mb-1">3. What is the 'Ask'?</label>
                        <input type="text" id="goalInput" placeholder="e.g. $200k budget" class="w-full bg-slate-950 border border-slate-700 rounded-lg p-2 text-xs text-white focus:border-cyan-500 outline-none">
                    </div>

                    <button onclick="handleTranslationRequest()" class="w-full bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-3 rounded-lg text-xs shadow-lg flex items-center justify-center gap-2 mt-2 transition-all hover:scale-[1.02]">
                        <i data-lucide="sparkles" class="h-4 w-4"></i> Translate Risk
                    </button>
                </div>
            </div>

            <!-- V.I.S.A. Reference -->
            <div class="card p-4 rounded-xl bg-slate-800/30 border-slate-700/30 flex-1">
                <h3 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-3">V.I.S.A. Framework</h3>
                <ul class="text-xs text-slate-400 space-y-3 font-mono">
                    <li class="flex items-center gap-2"><span class="w-5 h-5 rounded flex items-center justify-center bg-cyan-900/50 text-cyan-400 font-bold border border-cyan-800">V</span>Value Protected</li>
                    <li class="flex items-center gap-2"><span class="w-5 h-5 rounded flex items-center justify-center bg-cyan-900/50 text-cyan-400 font-bold border border-cyan-800">I</span>Impact (4 Losses)</li>
                    <li class="flex items-center gap-2"><span class="w-5 h-5 rounded flex items-center justify-center bg-cyan-900/50 text-cyan-400 font-bold border border-cyan-800">S</span>Story / Analogy</li>
                    <li class="flex items-center gap-2"><span class="w-5 h-5 rounded flex items-center justify-center bg-cyan-900/50 text-cyan-400 font-bold border border-cyan-800">A</span>Action Required</li>
                </ul>
            </div>

            <!-- Footer -->
            <div class="text-[10px] text-slate-600 text-center mt-auto">
                &copy; 2025 Martin M. Kamethu
            </div>
        </aside>

        <!-- MAIN STAGE -->
        <section class="flex-1 relative overflow-hidden flex flex-col h-full rounded-xl bg-slate-900/50 border border-slate-800">
            
            <!-- Empty State -->
            <div id="emptyState" class="absolute inset-0 flex flex-col items-center justify-start pt-10 z-10 overflow-y-auto">
                <div class="text-center max-w-2xl px-6">
                    <div class="bg-slate-900 p-4 rounded-2xl w-16 h-16 flex items-center justify-center mx-auto mb-6 border border-slate-800 shadow-xl">
                        <i data-lucide="brain-circuit" class="h-8 w-8 text-cyan-500"></i>
                    </div>
                    <h2 class="text-xl font-bold text-white mb-2">Strategic Command Center</h2>
                    <p class="text-slate-400 text-xs mb-8">Follow the steps below to generate a board-ready communication strategy.</p>
                    
                    <!-- 3 Step Guide -->
                    <div class="grid md:grid-cols-3 gap-4 text-left mb-8 w-full">
                        <!-- Step 1 -->
                        <div class="bg-slate-900 p-4 rounded-xl border border-slate-800 hover:border-cyan-500/30 transition-colors group">
                            <div class="text-cyan-400 font-bold text-[10px] uppercase mb-2 flex items-center gap-2">
                                <i data-lucide="mouse-pointer" class="h-3 w-3"></i> Step 1: Threat
                            </div>
                            <h3 class="text-white text-sm font-semibold mb-1">Identify the Risk</h3>
                            <p class="text-[10px] text-slate-400 leading-relaxed">Select a known threat from the list, or use the 'Infinite Mode' to type any emerging technical risk.</p>
                        </div>

                        <!-- Step 2 -->
                        <div class="bg-slate-900 p-4 rounded-xl border border-slate-800 hover:border-emerald-500/30 transition-colors group">
                            <div class="text-emerald-400 font-bold text-[10px] uppercase mb-2 flex items-center gap-2">
                                <i data-lucide="users" class="h-3 w-3"></i> Step 2: Audience
                            </div>
                            <h3 class="text-white text-sm font-semibold mb-1">Target the Stakeholder</h3>
                            <p class="text-[10px] text-slate-400 leading-relaxed">Calibrate the language. Boards need Strategy, CFOs need Fiscal Impact, and Employees need Culture.</p>
                        </div>

                        <!-- Step 3 -->
                        <div class="bg-slate-900 p-4 rounded-xl border border-slate-800 hover:border-amber-500/30 transition-colors group">
                            <div class="text-amber-400 font-bold text-[10px] uppercase mb-2 flex items-center gap-2">
                                <i data-lucide="zap" class="h-3 w-3"></i> Step 3: Translation
                            </div>
                            <h3 class="text-white text-sm font-semibold mb-1">Generate Narrative</h3>
                            <p class="text-[10px] text-slate-400 leading-relaxed">The engine converts the technical input into a "Campaign Kit" with analogies, scripts, and financial impacts.</p>
                        </div>
                    </div>

                    <!-- Pro Tip -->
                    <div class="bg-slate-900/80 rounded-lg p-3 border border-slate-800 flex items-center gap-3 text-left w-full max-w-lg mx-auto">
                        <div class="bg-cyan-500/10 p-2 rounded-md shrink-0">
                            <i data-lucide="key" class="h-4 w-4 text-cyan-400"></i>
                        </div>
                        <div>
                            <p class="text-xs font-bold text-slate-300 uppercase">Pro Tip: Infinite Mode</p>
                            <p class="text-[10px] text-slate-500">Click <span class="text-white font-mono px-1 bg-slate-800 rounded cursor-pointer hover:text-cyan-400" onclick="toggleSettings()">Settings ⚙️</span> to add your Gemini API Key for custom topics.</p>
                        </div>
                    </div>

                    <!-- Progress Bar -->
                    <div id="progressContainer" class="hidden mt-8 w-full max-w-xs mx-auto">
                        <div class="flex justify-between text-[10px] text-cyan-400 uppercase font-bold mb-1">
                            <span id="progressLabel">Initializing...</span><span id="progressText">0%</span>
                        </div>
                        <div class="h-1.5 bg-slate-900 rounded-full overflow-hidden border border-slate-800">
                            <div id="progressBar" class="h-full bg-cyan-500 w-0 transition-all duration-300 ease-out shadow-[0_0_10px_rgba(34,211,238,0.5)]"></div>
                        </div>
                        <p class="text-[10px] text-slate-500 mt-2 animate-pulse">Consulting the Cyber Story Architect...</p>
                    </div>
                </div>
            </div>

            <!-- RESULTS GRID -->
            <div id="resultsContainer" class="hidden flex-col gap-3 h-full p-4 overflow-y-auto animate-fade-in">
                
                <!-- Row 1: Headline & Analogy -->
                <div class="grid lg:grid-cols-3 gap-3 min-h-[140px]">
                    <div class="col-span-2 card p-4 rounded-xl border-l-4 border-cyan-500 relative flex flex-col justify-center">
                        <span class="text-[9px] font-bold text-cyan-400 uppercase tracking-widest mb-1">The Hook</span>
                        <h2 id="outHeadline" class="text-xl font-bold text-white leading-snug pr-8"></h2>
                        <button onclick="copyToClipboard('outHeadline')" class="absolute top-3 right-3 text-slate-600 hover:text-white"><i data-lucide="copy" class="h-3 w-3"></i></button>
                    </div>
                    <div class="card p-4 rounded-xl bg-slate-900/50 border border-slate-800 flex flex-col justify-center">
                        <div class="flex items-center gap-2 mb-2">
                            <i data-lucide="lightbulb" class="h-3 w-3 text-amber-400"></i>
                            <span class="text-[9px] font-bold text-slate-400 uppercase">The Analogy</span>
                        </div>
                        <p id="outAnalogy" class="text-xs text-slate-300 italic leading-relaxed overflow-y-auto"></p>
                    </div>
                </div>

                <!-- Row 2: 4 Impacts -->
                <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-2 shrink-0">
                    <div class="bg-slate-900 p-2.5 rounded-lg border border-slate-800 border-t-2 border-t-red-500/50 hover:border-red-500/80 transition-colors">
                        <div class="flex items-center gap-1.5 mb-1 text-red-400"><i data-lucide="power-off" class="h-3 w-3"></i><span class="text-[9px] font-bold uppercase">Shutdown</span></div>
                        <p id="outShutdown" class="text-[10px] text-slate-400 leading-tight"></p>
                    </div>
                    <div class="bg-slate-900 p-2.5 rounded-lg border border-slate-800 border-t-2 border-t-orange-500/50 hover:border-orange-500/80 transition-colors">
                        <div class="flex items-center gap-1.5 mb-1 text-orange-400"><i data-lucide="wallet" class="h-3 w-3"></i><span class="text-[9px] font-bold uppercase">Cleanup</span></div>
                        <p id="outCleanup" class="text-[10px] text-slate-400 leading-tight"></p>
                    </div>
                    <div class="bg-slate-900 p-2.5 rounded-lg border border-slate-800 border-t-2 border-t-yellow-500/50 hover:border-yellow-500/80 transition-colors">
                        <div class="flex items-center gap-1.5 mb-1 text-yellow-400"><i data-lucide="scale" class="h-3 w-3"></i><span class="text-[9px] font-bold uppercase">Penalty</span></div>
                        <p id="outPenalty" class="text-[10px] text-slate-400 leading-tight"></p>
                    </div>
                    <div class="bg-slate-900 p-2.5 rounded-lg border border-slate-800 border-t-2 border-t-purple-500/50 hover:border-purple-500/80 transition-colors">
                        <div class="flex items-center gap-1.5 mb-1 text-purple-400"><i data-lucide="users" class="h-3 w-3"></i><span class="text-[9px] font-bold uppercase">Exodus</span></div>
                        <p id="outExodus" class="text-[10px] text-slate-400 leading-tight"></p>
                    </div>
                </div>

                <!-- Row 3: Script & Evidence -->
                <div class="grid lg:grid-cols-3 gap-3 flex-1 min-h-0">
                    <!-- Script -->
                    <div class="col-span-2 card p-4 rounded-xl flex flex-col h-full">
                        <div class="flex justify-between items-center mb-2 shrink-0">
                            <h3 class="text-xs font-bold text-white flex items-center gap-2"><i data-lucide="mic" class="h-3 w-3 text-pink-400"></i> The Script</h3>
                            <button onclick="copyToClipboard('outScript')" class="text-[9px] font-bold bg-slate-800 hover:bg-slate-700 text-white px-2 py-1 rounded transition-colors">Copy</button>
                        </div>
                        <div class="font-mono text-xs text-slate-300 bg-slate-950 p-3 rounded-lg border border-slate-800 flex-1 overflow-y-auto">
                            <p id="outScript" class="whitespace-pre-line leading-relaxed"></p>
                        </div>
                    </div>

                    <!-- Evidence & Objection -->
                    <div class="flex flex-col gap-3 h-full">
                        <div class="card p-3 rounded-xl shrink-0">
                            <h3 class="text-[9px] font-bold text-slate-500 mb-1 uppercase">Evidence</h3>
                            <div class="flex gap-2 items-start">
                                <i data-lucide="bar-chart-2" class="h-4 w-4 text-emerald-400 mt-0.5 shrink-0"></i>
                                <p id="outData" class="text-xs text-white font-medium leading-tight"></p>
                            </div>
                        </div>
                        <div class="card p-3 rounded-xl bg-slate-800/50 border border-indigo-500/20 flex-1 overflow-hidden flex flex-col">
                            <h3 class="text-[9px] font-bold text-slate-500 mb-1 uppercase shrink-0">Objection Handler</h3>
                            <div class="space-y-2 overflow-y-auto">
                                <div class="bg-slate-900/80 p-2 rounded border-l-2 border-slate-600">
                                    <p id="outObjectionQ" class="text-xs text-slate-300 italic">"..."</p>
                                </div>
                                <div class="bg-emerald-900/20 p-2 rounded border-l-2 border-emerald-500">
                                    <p id="outObjectionA" class="text-xs text-emerald-300 font-medium">"..."</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </section>
    </main>

    <!-- Settings Modal -->
    <div id="settingsModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-[100] flex items-center justify-center p-4">
        <div class="bg-slate-900 border border-slate-700 p-6 rounded-2xl w-full max-w-md shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-white">Engine Settings</h2>
                <button onclick="toggleSettings()" class="text-slate-500 hover:text-white"><i data-lucide="x" class="h-5 w-5"></i></button>
            </div>
            <div class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">Gemini API Key</label>
                    <input type="password" id="apiKeyInput" placeholder="Paste Google API Key..." class="w-full bg-slate-950 border border-slate-700 rounded-lg p-3 text-white focus:border-cyan-500 outline-none text-sm font-mono">
                    <div class="flex justify-between items-center mt-2">
                        <p class="text-[10px] text-slate-500">Stored locally in browser.</p>
                        <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-[10px] text-cyan-400 hover:underline flex items-center gap-1">Get Free Key <i data-lucide="external-link" class="h-3 w-3"></i></a>
                    </div>
                </div>
                <div class="pt-4 border-t border-slate-800 flex justify-end">
                    <button onclick="saveSettings()" class="bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg transition-colors text-sm">Save & Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let apiKey = ""; 
        document.addEventListener("DOMContentLoaded", () => {
            if (typeof lucide !== 'undefined') lucide.createIcons();
            const savedKey = localStorage.getItem("och_gemini_key");
            if(savedKey) {
                apiKey = savedKey;
                document.getElementById('apiKeyInput').value = savedKey;
                updateStatusIndicator(true);
            }
        });

        function toggleSettings() { document.getElementById('settingsModal').classList.toggle('hidden'); }
        
        function saveSettings() {
            const key = document.getElementById('apiKeyInput').value.trim();
            apiKey = key;
            localStorage.setItem("och_gemini_key", key);
            updateStatusIndicator(!!key);
            toggleSettings();
        }

        function updateStatusIndicator(isOnline) {
            const statusDiv = document.getElementById('systemStatus');
            if (isOnline) {
                statusDiv.innerHTML = '<span class="w-1.5 h-1.5 rounded-full bg-cyan-400 animate-pulse"></span> GEMINI AI';
                statusDiv.classList.replace('text-slate-500', 'text-cyan-400');
            } else {
                statusDiv.innerHTML = '<span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span> LOCAL DB';
                statusDiv.classList.replace('text-cyan-400', 'text-slate-500');
            }
        }

        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).innerText;
            navigator.clipboard.writeText(text);
        }

        // --- LOGIC ENGINE ---
        const masterDB = {
            "Agentic AI": {
                "Board": {
                    hook: "We are moving from AI that drafts our emails to AI that sends them.",
                    analogy: "Imagine hiring 1,000 interns, giving them all corporate credit cards, and then leaving the office for the weekend. That is Agentic AI without guardrails.",
                    shutdown: "Sales agents get stuck in loops, sending 50k emails in an hour. We have to kill the sales platform.",
                    cleanup: "Forensic audit of 10,000 auto-signed contracts and refunds.",
                    penalty: "Liability for discriminatory hiring decisions (EU AI Act).",
                    exodus: "High-value clients leave because they feel 'tricked' by our bots.",
                    data: "Air Canada (2024) was ruled liable for its chatbot's hallucinated refund policy.",
                    script: "We are making a mistake treating AI as a tool. It is a workforce. We are about to deploy agents that can spend money and sign contracts. My proposal isn't to stop them—speed is survival. But we need to build an 'Observability Layer' to hold the leash.",
                    objQ: "Why do we need new budget? We just bought AI tools.",
                    objA: "We bought the car. Now I need budget for the brakes."
                },
                "CFO": {
                    hook: "We are deploying software that has the authority to spend unbudgeted money.",
                    analogy: "The 'High-Speed Trader' effect. Agentic AI is an algorithm with access to our operational wallet. If it glitches, it spends.",
                    shutdown: "Cloud bill spikes 500% in 4 hours due to a recursive agent loop.",
                    cleanup: "Cost to manually reverse thousands of auto-approved transactions.",
                    penalty: "Fines for automated GDPR violations at scale.",
                    exodus: "Lifetime Value drops as trust erodes from automated harassment.",
                    data: "Knight Capital lost $440M in 45 minutes due to an automated trading glitch.",
                    script: "I am asking for this budget to prevent a financial hemorrhage. Right now, our AI agents have 'unlimited credit'. If they glitch, they spend. This investment puts a 'hard limit' on their authority.",
                    objQ: "Can't we just tell IT to block the agents?",
                    objA: "If we block them, our competitors outpace us. We need to cap the risk, not kill the speed."
                }
            },
            "Non-Human Identity": {
                "Board": {
                    hook: "We secured the front door, but left the loading dock open for invisible vendors.",
                    analogy: "The 'Unreturned Badges'. Imagine we fired 50 people but forgot to take their keys back. Now multiply that by 100. Those are our 'Ghost Bots'.",
                    shutdown: "Critical systems fail silently when a 'service account' expires.",
                    cleanup: "Cost to rotate 5,000 keys manually after a breach.",
                    penalty: "Regulatory scrutiny on 'Lack of Access Control' (SOX/NIS2).",
                    exodus: "Enterprise clients terminate contracts because we are a supply chain risk.",
                    data: "Microsoft's 2024 breach happened via a dormant test account with no MFA.",
                    script: "Look around this table. For every person here, there are 144 'machine users' on our network. They have keys, they move data, and they never sleep. I need a mandate to treat these bots with the same rigor we treat employees.",
                    objQ: "Is this really a priority over Ransomware?",
                    objA: "This IS how ransomware gets in now. They don't break in; they log in as a machine."
                },
                "CFO": {
                    hook: "90% of our 'users' are not on the payroll, but they have access to the bank.",
                    analogy: "The 'Ghost Employee'. We are effectively paying for thousands of users we don't know exist, and they are holding the keys to our IP.",
                    shutdown: "Revenue halts for 12 hours when a payment API token expires.",
                    cleanup: "3 weeks of engineering overtime to manually find and fix the breach.",
                    penalty: "Audit failure: 'Who owns this bot?' We can't answer.",
                    exodus: "We become the 'Typhoid Mary' that infects our customers.",
                    data: "Machine identities now outnumber humans 144:1 (CyberArk 2025).",
                    script: "This is an efficiency play as much as a security one. We have thousands of 'ghost accounts' cluttering our system. Managing them manually costs us $X in engineering hours per year. This tool automates that.",
                    objQ: "Why does this tool cost so much?",
                    objA: "It's cheaper than the 3 weeks of downtime when a certificate expires unnoticed."
                }
            },
            "Ransomware": {
                "Board": {
                    hook: "It's not about data theft anymore; it's about extortion of our ability to function.",
                    analogy: "The 'Hostage Situation'. They don't steal the car; they take the keys and threaten to crush it if we don't pay.",
                    shutdown: "Operations freeze. We cannot ship, bill, or communicate.",
                    cleanup: "Reputation rebuilding costs exceed the technical costs.",
                    penalty: "Class action lawsuits for negligence.",
                    exodus: "Competitors use our downtime to steal market share.",
                    data: "MGM Resorts lost $100M in profit from one ransomware attack in 2023.",
                    script: "We need to shift our mindset from 'Prevention' to 'Resilience'. The only metric that matters is 'Time to Recover'. Currently, that number is 14 days. I need your support to bring that down to 4 hours.",
                    objQ: "I thought our firewall prevented this?",
                    objA: "Firewalls stop burglars. Ransomware is often an inside job or a stolen key."
                }
            },
            "Zero Trust": {
                "Board": {
                    hook: "We are moving from 'Trust but Verify' to 'Verify, then Trust'.",
                    analogy: "The 'Airport Security' Model. Currently, we check ID at the front door (VPN), but then let people roam anywhere. Zero Trust means checking ID at every gate and every plane.",
                    shutdown: "Attacks are contained to one laptop, not the whole network.",
                    cleanup: "Drastically reduced because the 'blast radius' is smaller.",
                    penalty: "Compliance with modern standards (White House EO 14028).",
                    exodus: "Customers trust us as a 'Bank-Grade' secure partner.",
                    data: "IBM 2024: Zero Trust saves $1M+ per breach compared to traditional security.",
                    script: "The old security model was 'M&M's'—hard shell, soft center. Once you were in, you owned everything. Zero Trust builds watertight compartments like a submarine. If one floods, the ship doesn't sink. It's a journey, but it's the only way to survive modern attacks.",
                    objQ: "Will this make it harder for employees to work?",
                    objA: "Done right, it's invisible. We verify the device, not just the password."
                }
            }
        };

        const genericResponse = {
            hook: "We are operating with a hidden risk that threatens our objectives.",
            analogy: "It's like driving a sports car at 100mph with no brakes.",
            shutdown: "Operational paralysis for 24-48 hours.",
            cleanup: "High costs for consultants and emergency response.",
            penalty: "Potential regulatory fines for negligence.",
            exodus: "Loss of customer trust and market share.",
            data: "Cybercrime costs are projected to hit $10.5 Trillion by 2025.",
            script: "We need to address this risk immediately. The cost of prevention is a fraction of the cost of the cure.",
            objQ: "Is this in the budget?",
            objA: "The cost of inaction is 10x the cost of this investment."
        };

        async function handleTranslationRequest() {
            const topic = document.getElementById('topicInput').value;
            const audience = document.getElementById('audienceInput').value;
            const goal = document.getElementById('goalInput').value || "Risk Mitigation";

            if (!topic) { alert("Please select a Risk Topic."); return; }

            document.getElementById('emptyState').classList.add('hidden');
            document.getElementById('resultsContainer').classList.add('hidden');
            document.getElementById('emptyState').classList.remove('hidden');
            document.getElementById('progressContainer').classList.remove('hidden');
            
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const progressLabel = document.getElementById('progressLabel');
            
            const animate = (w, t, l) => {
                progressBar.style.width = w + "%";
                progressText.innerText = t + "%";
                progressLabel.innerText = l;
            };

            const localData = masterDB[topic] ? (masterDB[topic][audience] || masterDB[topic]["Board"]) : null;

            if (localData) {
                animate(50, 50, "Found in Local DB...");
                setTimeout(() => { animate(100, 100, "Rendering..."); }, 600);
                setTimeout(() => { renderResults(localData); }, 1000);
            } else if (apiKey && apiKey.length > 10) {
                animate(30, 30, "Calling Gemini AI...");
                try {
                    const aiData = await callGeminiAPI(topic, audience, goal, (pct, msg) => animate(pct, pct, msg));
                    renderResults(aiData);
                } catch (error) {
                    console.error(error);
                    alert("AI Error: " + error.message);
                    renderResults(genericResponse);
                }
            } else {
                setTimeout(() => {
                    alert("Topic not in local DB. Please add Gemini API Key in Settings.");
                    renderResults(genericResponse);
                }, 1000);
            }
        }

        async function callGeminiAPI(topic, audience, goal, progressCallback) {
            const systemPrompt = `
                You are the OCH CyberLingua Engine. Convert this cybersecurity risk into a business narrative using the V.I.S.A. Framework.
                INPUTS: Risk: "${topic}", Audience: "${audience}", Goal: "${goal}".
                OUTPUT JSON ONLY: {
                    "hook": "1 sentence headline",
                    "analogy": "Physical world metaphor (no jargon)",
                    "shutdown": "Productivity loss description",
                    "cleanup": "Cash response cost",
                    "penalty": "Regulatory fine",
                    "exodus": "Reputation loss",
                    "data": "Relevant statistic",
                    "script": "45-second elevator pitch",
                    "objQ": "Likely difficult question",
                    "objA": "Winning answer"
                }
            `;
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: systemPrompt }] }] })
            });
            progressCallback(90, "Parsing...");
            if (!response.ok) throw new Error("API Failed");
            const data = await response.json();
            const text = data.candidates[0].content.parts[0].text;
            const jsonString = text.replace(/```json/g, '').replace(/```/g, '').trim();
            return JSON.parse(jsonString);
        }

        function renderResults(data) {
            document.getElementById('outHeadline').innerText = data.hook;
            document.getElementById('outAnalogy').innerText = `"${data.analogy}"`;
            document.getElementById('outShutdown').innerText = data.shutdown;
            document.getElementById('outCleanup').innerText = data.cleanup;
            document.getElementById('outPenalty').innerText = data.penalty;
            document.getElementById('outExodus').innerText = data.exodus;
            document.getElementById('outData').innerText = data.data;
            document.getElementById('outScript').innerText = data.script;
            document.getElementById('outObjectionQ').innerText = `"${data.objQ}"`;
            document.getElementById('outObjectionA').innerText = `"${data.objA}"`;

            document.getElementById('emptyState').classList.add('hidden');
            document.getElementById('resultsContainer').classList.remove('hidden');
            if (typeof lucide !== 'undefined') lucide.createIcons();
            
            document.getElementById('progressContainer').classList.add('hidden');
            document.getElementById('progressBar').style.width = '0%';
        }
    </script>
</body>
</html>
